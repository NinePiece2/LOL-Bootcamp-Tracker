# Authentication System - Quick Guide

## Overview
The LoL KR Bootcamp Tracker now supports multi-user authentication. Users can create accounts, manage their own bootcamper lists, and view default bootcampers created by admins.

## Features Implemented

### 1. User Registration & Login
- **Sign Up**: New users can register with email and password
- **Sign In**: Existing users can log in
- **Session Management**: Uses NextAuth.js with JWT strategy
- **UI Components**: Login and Register dialogs accessible from navigation

### 2. User Roles
- **Regular Users**: Can create and manage their own bootcamper lists
- **Admin Users**: Can create default bootcampers visible to everyone and manage all bootcampers

### 3. Bootcamper Lists
- **Default List**: Admin-created bootcampers visible to all users (including non-authenticated)
- **User Lists**: Personal bootcamper lists for authenticated users
- **List Switcher**: Authenticated users can toggle between default and personal lists

### 4. Protected Routes
- **Roster Page**: Only accessible to authenticated users
- **API Protection**: Create/Edit/Delete operations require authentication

## Getting Started

### 1. First Time Setup

The application has NextAuth configured. The following environment variables were added to `.env`:
```
NEXTAUTH_SECRET=<auto-generated>
NEXTAUTH_URL=http://localhost:3000
```

### 2. Create Your Admin Account

1. **Register an account** through the UI:
   - Click "Sign Up" in the navigation
   - Enter your email, password, and optionally your name
   - Submit the form

2. **Make yourself admin** (run this in terminal):
   ```bash
   npx tsx scripts/make-admin.ts your@email.com
   ```

   This script will:
   - Find your user by email
   - Set `isAdmin = true`
   - Confirm the change

### 3. Using the System

#### As a Non-Authenticated User:
- View default bootcampers on Dashboard and Leaderboard
- Cannot access Roster page
- Cannot create or edit bootcampers

#### As an Authenticated Regular User:
- Create and manage personal bootcamper lists
- Switch between "Default List" and "My List" views
- Access Roster page to manage bootcampers
- Cannot create default bootcampers

#### As an Admin User:
- All regular user capabilities
- Create default bootcampers (visible to everyone)
- Edit and delete any bootcamper
- Admin badge in user menu

## How It Works

### List Types

**Default Bootcampers** (`isDefault = true`):
- Created by admins
- Visible to all users (authenticated and non-authenticated)
- Intended for "official" KR bootcamp participants
- Shown when "Default List" is selected

**User Bootcampers** (`isDefault = false`, `userId = <user_id>`):
- Created by regular users
- Only visible to the user who created them
- Personal tracking lists
- Shown when "My List" is selected

### API Filtering

All API endpoints support `listType` query parameter:
- `/api/bootcampers?listType=default` - Returns default bootcampers
- `/api/bootcampers?listType=user` - Returns user's own bootcampers
- `/api/bootcampers/ranks?listType=default` - Leaderboard for default list
- `/api/bootcampers/ranks?listType=user` - Leaderboard for user's list

### Authorization

- **Create**: Requires authentication. Regular users create user-specific bootcampers, admins can create default ones
- **Edit**: Users can only edit their own bootcampers. Admins can edit any bootcamper
- **Delete**: Users can only delete their own bootcampers. Admins can delete any bootcamper
- **View**: Default bootcampers visible to all, user bootcampers only to owner

## UI Components

### Navigation
- **Not logged in**: Shows "Sign In" and "Sign Up" buttons
- **Logged in**: Shows user avatar/email and dropdown menu
- **Admin badge**: Displayed in dropdown for admin users

### List Switcher
- Available on Dashboard, Leaderboard, and Roster pages
- Only visible to authenticated users
- Toggles between "Default List" and "My List"
- Selection persists across page navigation

### Dialogs
- **Login Dialog**: Email/password authentication
- **Register Dialog**: Account creation with email, password, optional name
- **User Menu**: Sign out, admin status indicator

## Database Schema

### User Model
```prisma
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String    // Hashed with bcrypt
  name          String?
  isAdmin       Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  bootcampers   Bootcamper[]
  sessions      Session[]
  accounts      Account[]
}
```

### Updated Bootcamper Model
```prisma
model Bootcamper {
  // ... existing fields
  userId          String?   @map("user_id")
  isDefault       Boolean   @default(false) @map("is_default")
  
  user            User?     @relation(fields: [userId], references: [id])
  
  @@unique([puuid, userId]) // Same player can be in different user lists
}
```

## Troubleshooting

### TypeScript Errors
If you see TypeScript errors about missing properties like `userId` or `isDefault`:
```bash
npx prisma generate
```

### Make Admin Script Not Working
Ensure you're using the exact email you registered with:
```bash
npx tsx scripts/make-admin.ts exact@email.com
```

### Can't See Roster Page
The Roster page is protected and only visible to authenticated users. Make sure you're logged in.

### Bootcampers Not Showing
- Check which list is selected (Default vs My List)
- If on "Default List", only admin-created bootcampers appear
- If on "My List", only your personal bootcampers appear

## Security Notes

- Passwords are hashed using bcrypt (12 rounds)
- Session tokens use JWT strategy
- API endpoints check authentication and authorization
- Protected routes redirect non-authenticated users
- NEXTAUTH_SECRET should be kept secure (already generated and added to .env)

## Next Steps

1. **Register your account** through the UI
2. **Make yourself admin** using the script
3. **Create some default bootcampers** for public viewing
4. **Users can create their own lists** for personal tracking

Enjoy tracking your Korean bootcamp progress! ðŸŽ®
